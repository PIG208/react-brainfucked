{"version":3,"sources":["core/IOStream.ts","core/Interpreter.ts","core/ImmutableList.ts","core/Runner.ts","core/utils.ts","hooks/useBrainfuck.ts","components/Console.tsx","components/ControlPanel.tsx","components/Editor.tsx","components/Visualization.tsx","components/App.tsx","index.tsx"],"names":["copyStream","stream","buffer","slice","readBuffer","initializeIOStream","size","pointer","readPointer","ioReducer","action","type","newStream","length","Error","read","data","concat","write","index","seek","instructionSet","Set","copyState","state","readMemory","memory","query","dataPointer","writeMemory","update","isEnded","programCounter","program","isStarted","parse","output","startsWith","count","s","has","push","brainfuckReducer","newState","instruction","fetchInstruction","overridePc","skipping","stdin","undefined","stdout","jmpStack","pop","next","writeToStdin","buildTree","start","end","mid","Math","floor","left","right","key","value","queryTree","node","updateTree","newNode","Object","assign","sliceTree","result","List","root","fromArray","this","array","createList","MAX_PROGRAM_CYCLES","run","cycles","console","error","finalState","numCycles","ended","ASCIIsToString","n","String","fromCharCode","stringToASCIIs","Array","from","map","c","charCodeAt","setup","parsed","fill","Console","programState","dispatch","useState","inputText","setInputText","ioBuffers","useMemo","input","className","onKeyUp","e","onChange","target","ControlPanel","onClick","disabled","Editor","code","setCode","enabled","language","placeholder","val","padding","style","fontSize","Visualization","pc","App","initialProgram","setProgram","parsedProgram","setProgramState","useCallback","useBrainfuck","brainfuck","editorEnabled","useEffect","id","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.d75a6d36.chunk.js","sourcesContent":["import { ReducerAction } from \"../types\";\n\nexport type IOAction =\n  | ReducerAction<\"read\" | \"seek\", number>\n  | ReducerAction<\"write\", number | number[]>;\nexport type IOStream = {\n  buffer: number[];\n  size: number;\n  pointer: number;\n  // The buffer for the last read\n  readPointer: number;\n  readBuffer: number[];\n};\n\nexport type ReadOutput = [stream: IOStream, data: number];\n\nconst copyStream = (stream: IOStream) => ({\n  ...stream,\n  buffer: stream.buffer.slice(0),\n  readBuffer: stream.readBuffer.slice(0),\n});\n\nexport const read = (stream: IOStream, size: number): IOStream => {\n  let newStream = copyStream(stream);\n  if (newStream.buffer.length <= newStream.readPointer) throw new Error(\"buffer overflowed\");\n  // Read `size` of bytes from the buffer\n  newStream.readBuffer = newStream.buffer.slice(\n    newStream.readPointer,\n    newStream.readPointer + size\n  );\n  newStream.readPointer = newStream.readPointer + size;\n\n  return newStream;\n};\n\nexport const write = (stream: IOStream, data: number | number[]): IOStream => {\n  if (typeof data == \"number\") data = [data];\n\n  let newStream = copyStream(stream);\n  newStream.buffer = newStream.buffer.slice(0, newStream.pointer).concat(data);\n  newStream.pointer += data.length;\n\n  return newStream;\n};\n\nconst seek = (stream: IOStream, index: number): IOStream => {\n  let newStream = copyStream(stream);\n  newStream.pointer = index;\n  newStream.readPointer = index;\n  return newStream;\n};\n\nexport const initializeIOStream = (size: number): IOStream => ({\n  buffer: [],\n  size: size,\n  pointer: 0,\n  readPointer: 0,\n  readBuffer: [],\n});\n\nexport const ioReducer = (stream: IOStream, action: IOAction): IOStream => {\n  switch (action.type) {\n    case \"read\":\n      return read(stream, action.data);\n    case \"write\":\n      return write(stream, action.data);\n    case \"seek\":\n      return seek(stream, action.data);\n  }\n};\n","import { ReducerAction } from \"../types\";\nimport { ioReducer, IOStream } from \"./IOStream\";\nimport { List } from \"./ImmutableList\";\n\nexport type BrainfuckCoreAction = ReducerAction<\"next\"> | ReducerAction<\"write\", number[]>;\nconst instructionSet = new Set([\"<\", \">\", \",\", \".\", \"[\", \"]\", \"+\", \"-\"]);\nexport type Instruction = \"<\" | \">\" | \",\" | \".\" | \"[\" | \"]\" | \"+\" | \"-\";\n\nexport type ProgramState = {\n  programCounter: number;\n  dataPointer: number;\n  memory: List<number>;\n  jmpStack: number[];\n  program: Instruction[];\n\n  skipping: boolean;\n\n  stdin: IOStream;\n  stdout: IOStream;\n};\n\nconst copyState = (state: ProgramState): ProgramState => ({\n  ...state,\n});\n\nconst readMemory = (state: ProgramState) => state.memory.query(state.dataPointer);\nconst writeMemory = (state: ProgramState, data: number) =>\n  (state.memory = state.memory.update(state.dataPointer, data));\nconst fetchInstruction = (state: ProgramState): Instruction => state.program[state.programCounter];\n\nexport const isEnded = (state: ProgramState) => state.programCounter === state.program.length;\nexport const isStarted = (state: ProgramState) => state.programCounter > 0;\n\n/**\n * Parse out the initial loop and ignore non-instruction characters\n */\nexport const parse = (program: string): Instruction[] => {\n  let output: any = [];\n  if (program.startsWith(\"[\")) {\n    let count = 1,\n      index = 1;\n    while (count > 0) {\n      if (program[index] === \"[\") {\n        count++;\n      }\n      if (program[index] === \"]\") {\n        count--;\n      }\n      if (index > 30000) {\n        throw new Error(\"Unbalanced brackets\");\n      }\n      index++;\n    }\n    program = program.slice(index + 1);\n  }\n\n  for (let s of program) {\n    if (instructionSet.has(s)) {\n      output.push(s);\n    }\n  }\n  return output;\n};\n\nconst next = (state: ProgramState): ProgramState => {\n  if (isEnded(state)) return state;\n\n  let newState = copyState(state);\n  const instruction = fetchInstruction(newState);\n  let overridePc = false;\n\n  if (newState.skipping && instruction !== \"]\") {\n    newState.programCounter++;\n    return newState;\n  }\n\n  switch (instruction) {\n    case \">\":\n      newState.dataPointer++;\n      break;\n    case \"<\":\n      newState.dataPointer--;\n      break;\n    case \"+\":\n      writeMemory(newState, readMemory(newState) + 1);\n      break;\n    case \"-\":\n      writeMemory(newState, readMemory(newState) - 1);\n      break;\n    case \",\":\n      newState.stdin = ioReducer(newState.stdin, { type: \"read\", data: 1 });\n      writeMemory(newState, newState.stdin.readBuffer[0]);\n      if (newState.stdin.readBuffer[0] === undefined)\n        throw new Error(`invalid write ${newState.stdin}`);\n      break;\n    case \".\":\n      newState.stdout = ioReducer(newState.stdout, { type: \"write\", data: readMemory(newState) });\n      break;\n    case \"[\":\n      if (readMemory(newState) !== 0) {\n        // We can jump back to this point\n        newState.jmpStack.push(newState.programCounter);\n      } else {\n        // Skip the entire loop body until we reaches the corresponding ]\n        newState.skipping = true;\n      }\n      break;\n    case \"]\":\n      if (readMemory(newState) === 0) {\n        // When the data pointer becomes 0, reset the stack and continue\n        newState.jmpStack.pop();\n      } else {\n        // Jump back to the top of the jmpStack\n        newState.programCounter = newState.jmpStack[newState.jmpStack.length - 1] + 1;\n        overridePc = true;\n      }\n      break;\n  }\n\n  if (!overridePc) newState.programCounter++;\n\n  return newState;\n};\n\n/**\n * Write directly to the standard input stream\n */\nconst writeToStdin = (state: ProgramState, data: number[]) => {\n  let newState = copyState(state);\n  newState.stdin = ioReducer(newState.stdin, { type: \"write\", data: data });\n\n  return newState;\n};\n\nexport const brainfuckReducer = (\n  state: ProgramState,\n  action: BrainfuckCoreAction\n): ProgramState => {\n  switch (action.type) {\n    case \"next\":\n      return next(state);\n    case \"write\":\n      return writeToStdin(state, action.data);\n  }\n};\n","type TreeNode<V> = {\n  size: number;\n  key: number;\n  value: V;\n  left?: TreeNode<V>;\n  right?: TreeNode<V>;\n};\n\nconst buildTree = <V>(data: V[], start: number, end: number): TreeNode<V> => {\n  if (start > end) throw new Error(\"Cannot parse an empty array\");\n\n  const mid = start + Math.floor((end - start) / 2);\n  const left = start < mid ? buildTree(data, start, mid - 1) : undefined;\n  const right = end > mid ? buildTree(data, mid + 1, end) : undefined;\n  return {\n    size: (left?.size ?? 0) + (right?.size ?? 0),\n    key: mid,\n    value: data[mid],\n    left: left,\n    right: right,\n  };\n};\n\nconst queryTree = <V>(key: number, node?: TreeNode<V>): V => {\n  if (!!!node) throw new Error(\"List index out of bounds\");\n  if (node.key === key) return node.value;\n\n  return node.key > key ? queryTree(key, node.left) : queryTree(key, node.right);\n};\n\nconst updateTree = <V>(key: number, value: V, node?: TreeNode<V>): TreeNode<V> => {\n  if (!!!node) throw new Error(\"List index out of bounds\");\n  let newNode = Object.assign({}, node);\n\n  if (newNode.key === key) {\n    newNode.value = value;\n    return newNode;\n  }\n\n  if (newNode.key > key) {\n    newNode.left = updateTree(key, value, newNode.left);\n  } else {\n    newNode.right = updateTree(key, value, newNode.right);\n  }\n\n  return newNode;\n};\n\nconst sliceTree = <V>(result: V[], start: number, end: number, node?: TreeNode<V>) => {\n  if (!!!node) throw new Error(\"List index out of range\");\n\n  if (node.left) sliceTree(result, start, end, node.left);\n  if (node.key >= start && node.key < end) result.push(node.value);\n  if (node.right) sliceTree(result, start, end, node.right);\n};\n\nconst createList = <V>(data: V[]): List<V> => new List({ fromArray: true, array: data });\n\nexport class List<V> {\n  root: TreeNode<V>;\n  constructor(data: { fromArray: true; array: V[] } | { fromArray: false; root: TreeNode<V> }) {\n    if (data.fromArray) {\n      this.root = buildTree(data.array, 0, data.array.length - 1);\n    } else {\n      this.root = data.root;\n    }\n  }\n\n  query(key: number): V {\n    return queryTree(key, this.root);\n  }\n\n  /**\n   * Perform an efficient immutable update to the list\n   */\n  update(key: number, value: V): List<V> {\n    const newRoot = updateTree(key, value, this.root);\n    return new List({ fromArray: false, root: newRoot });\n  }\n\n  slice(start: number, end: number): V[] {\n    let result: V[] = [];\n    sliceTree(result, start, end, this.root);\n    return result;\n  }\n}\n\nexport default createList;\n","import { IOStream } from \"./IOStream\";\nimport createList from \"./ImmutableList\";\nimport { ProgramState, Instruction, brainfuckReducer, isEnded } from \"./Interpreter\";\n\nexport type RunResult = {\n  finalState: ProgramState;\n  numCycles: number;\n  ended: boolean;\n};\n\nconst MEMORY_SIZE = 30000;\nexport const MAX_PROGRAM_CYCLES = 2 << 16;\n\nexport const setupProgram = (\n  program: Instruction[],\n  stdin: IOStream,\n  stdout: IOStream\n): ProgramState => ({\n  programCounter: 0,\n  dataPointer: 0,\n  memory: createList(Array(MEMORY_SIZE).fill(0)),\n  jmpStack: [],\n  program: program,\n\n  skipping: false,\n\n  stdin: stdin,\n  stdout: stdout,\n});\n\nexport const runCycles = (state: ProgramState, cycles: number): RunResult => {\n  let cyclesCount = 0;\n  while (!isEnded(state) && cyclesCount++ < cycles) {\n    state = brainfuckReducer(state, { type: \"next\" });\n  }\n  return {\n    finalState: state,\n    numCycles: cyclesCount,\n    ended: isEnded(state),\n  };\n};\n\nexport const run = (state: ProgramState): RunResult => {\n  let cycles = 0;\n  while (!isEnded(state) && ++cycles < MAX_PROGRAM_CYCLES) {\n    state = brainfuckReducer(state, { type: \"next\" });\n  }\n\n  if (cycles === MAX_PROGRAM_CYCLES && !isEnded(state)) {\n    console.error(\"The program runs exceeding the time limit\");\n  }\n\n  return {\n    finalState: state,\n    numCycles: cycles,\n    ended: isEnded(state),\n  };\n};\n","export const ASCIIsToString = (n: number[]): string => String.fromCharCode(...n);\nexport const stringToASCIIs = (s: string): number[] => Array.from(s).map((c) => c.charCodeAt(0));\n","import { useCallback, useMemo, useState } from \"react\";\n\nimport { initializeIOStream } from \"../core/IOStream\";\nimport { brainfuckReducer, Instruction, parse, ProgramState } from \"../core/Interpreter\";\nimport { run, setupProgram } from \"../core/Runner\";\nimport { stringToASCIIs } from \"../core/utils\";\nimport { ReducerAction, ReducerHookReturnType } from \"../types\";\n\nexport type BrainfuckAction =\n  | ReducerAction<\"load\", string>\n  | ReducerAction<\"next\" | \"reset\" | \"run\">\n  | ReducerAction<\"write\", string>;\nconst DEFAULT_STREAM_SIZE = 2 << 10;\nconst setup = (parsed: Instruction[]) =>\n  setupProgram(\n    parsed,\n    initializeIOStream(DEFAULT_STREAM_SIZE),\n    initializeIOStream(DEFAULT_STREAM_SIZE)\n  );\n\nexport const useBrainfuck = (\n  initialProgram: string = \"\"\n): ReducerHookReturnType<ProgramState, BrainfuckAction> => {\n  const [program, setProgram] = useState(initialProgram);\n  const parsedProgram = useMemo(() => {\n    return parse(program);\n  }, [program]);\n  const [programState, setProgramState] = useState<ProgramState>(setup(parsedProgram));\n\n  const dispatch = useCallback(\n    (action: BrainfuckAction) => {\n      switch (action.type) {\n        case \"load\":\n          setProgram(action.data);\n          break;\n        case \"next\":\n          setProgramState((programState) => brainfuckReducer(programState, { type: \"next\" }));\n          break;\n        case \"run\":\n          setProgramState((programState) => run(programState).finalState);\n          break;\n        case \"reset\":\n          setProgramState(setup(parsedProgram));\n          break;\n        case \"write\":\n          setProgramState((programState) =>\n            brainfuckReducer(programState, { type: \"write\", data: stringToASCIIs(action.data) })\n          );\n          break;\n      }\n    },\n    [setProgram, setProgramState, parsedProgram]\n  );\n\n  return [programState, dispatch];\n};\n","import { useMemo, useState } from \"react\";\n\nimport { BrainfuckAction } from \"../hooks/useBrainfuck\";\n\nimport \"../css/Console.css\";\n\nimport { ProgramState } from \"../core/Interpreter\";\nimport { ASCIIsToString } from \"../core/utils\";\n\nexport type ConsoleProps = {\n  programState: ProgramState;\n  dispatch: (action: BrainfuckAction) => void;\n};\n\nconst Console = ({ programState, dispatch }: ConsoleProps) => {\n  const [inputText, setInputText] = useState(\"\");\n  const ioBuffers = useMemo(\n    () => ({\n      output: ASCIIsToString(programState.stdout.buffer),\n      input: ASCIIsToString(programState.stdin.buffer),\n    }),\n    [programState]\n  );\n\n  return (\n    <div>\n      <div className=\"console\">\n        <div>{ioBuffers.output}</div>\n      </div>\n      <div className=\"console with-input\">\n        <div>{ioBuffers.input}</div>\n        <div className=\"console-input\">\n          <input\n            value={inputText}\n            onKeyUp={(e) => {\n              if (e.key === \"Enter\") {\n                dispatch({ type: \"write\", data: inputText });\n                setInputText(\"\");\n              }\n            }}\n            onChange={(e) => setInputText(e.target.value)}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Console;\n","import { BrainfuckAction } from \"../hooks/useBrainfuck\";\n\nimport \"../css/ControlPanel.css\";\n\nimport { ProgramState, isEnded, isStarted } from \"../core/Interpreter\";\n\nexport type ControlPanelProps = {\n  programState: ProgramState;\n  dispatch: (action: BrainfuckAction) => void;\n};\n\nconst ControlPanel = ({ programState, dispatch }: ControlPanelProps) => {\n  return (\n    <ul className=\"panel\">\n      <li>\n        <button className=\"btn\" onClick={() => dispatch({ type: \"run\" })}>\n          Run\n        </button>\n      </li>\n      <li>\n        <button\n          className=\"btn\"\n          onClick={() => dispatch({ type: \"next\" })}\n          disabled={isEnded(programState)}\n        >\n          {isStarted(programState) ? \"Step\" : \"Start\"}\n        </button>\n      </li>\n      <li>\n        <button className=\"btn\" onClick={() => dispatch({ type: \"reset\" })}>\n          Reset\n        </button>\n      </li>\n    </ul>\n  );\n};\n\nexport default ControlPanel;\n","import CodeEditor from \"@uiw/react-textarea-code-editor\";\n\nexport type EditorProps = {\n  code: string;\n  setCode: (val: string) => void;\n  enabled: boolean;\n};\n\nconst Editor = ({ code, setCode, enabled }: EditorProps) => {\n  return (\n    <CodeEditor\n      value={code}\n      language=\"brainfuck\"\n      placeholder=\"brainfuck program here\"\n      onChange={(val) => setCode(val.target.value)}\n      padding={10}\n      style={{\n        fontSize: \"1.2rem\",\n      }}\n      disabled={!enabled}\n    />\n  );\n};\n\nexport default Editor;\n","import \"../css/Visualization.css\";\n\nimport { isStarted, ProgramState } from \"../core/Interpreter\";\n\nexport type VisualizationProps = {\n  programState: ProgramState;\n};\n\nconst Visualization = ({ programState }: VisualizationProps) => {\n  const isCurrentPc = (pc: number) =>\n    pc === programState.programCounter - 1 || (pc === 0 && programState.programCounter === 0);\n\n  return (\n    <div>\n      <p>program counter: {programState.programCounter}</p>\n      <p>data pointer: {programState.dataPointer}</p>\n      <p>current data: {programState.memory.query(programState.dataPointer)}</p>\n      <div className=\"program-field\">\n        {programState.program.map((instruction, index) => (\n          <span\n            key={index}\n            className={isStarted(programState) && isCurrentPc(index) ? \"highlighted\" : \"\"}\n          >\n            {instruction}\n          </span>\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport default Visualization;\n","import { useEffect, useState } from \"react\";\n\nimport { useBrainfuck } from \"../hooks/useBrainfuck\";\n\nimport \"../css/App.css\";\n\nimport Console from \"./Console\";\nimport ControlPanel from \"./ControlPanel\";\nimport Editor from \"./Editor\";\nimport Visualization from \"./Visualization\";\n\nfunction App() {\n  const [code, setCode] = useState(\"\");\n  const [brainfuck, dispatch] = useBrainfuck(code);\n  const [editorEnabled] = useState(true);\n\n  useEffect(() => {\n    dispatch({ type: \"load\", data: code });\n    dispatch({ type: \"reset\" });\n  }, [code, dispatch]);\n\n  return (\n    <div className=\"App\">\n      <main className=\"App-main\">\n        <div>\n          <h1 id=\"center\">react-brainfucked</h1>\n        </div>\n        <div>\n          <Editor code={code} setCode={setCode} enabled={editorEnabled} />\n          <Visualization programState={brainfuck} />\n          <ControlPanel programState={brainfuck} dispatch={dispatch} />\n          <Console programState={brainfuck} dispatch={dispatch} />\n        </div>\n      </main>\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./components/App\";\n\nimport \"./css/index.css\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}